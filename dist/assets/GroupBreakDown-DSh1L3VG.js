import{r as i,j as e,N as B,S as M,D as F,f as P,c as g,b as d,d as T,I as U}from"./index-DAP0bqfI.js";const I=()=>{const[H,h]=i.useState([]),[u,y]=i.useState(""),[j,v]=i.useState([]),[f,N]=i.useState(""),[_,p]=i.useState(!1),[k,c]=i.useState(!1),[V,w]=i.useState(null),[m,o]=i.useState([]),[r,G]=i.useState({group_name:"",group_type:"",group_value:"",group_install:"",group_members:"",group_duration:"",start_date:"",end_date:"",minimum_bid:"",maximum_bid:"",commission:5,reg_fee:""}),D=t=>{const{value:a}=t.target;N(a)};i.useEffect(()=>{(async()=>{try{const a=await d.get("/group/get-group-admin");h(a.data);const l=a.data.map((s,n)=>({_id:s._id,id:n+1,name:s.group_name,type:s.group_type,value:s.group_value,installment:s.group_install,members:s.group_members,action:e.jsx("div",{className:"flex justify-center gap-2",children:e.jsx(T,{menu:{items:[{key:"1",label:e.jsx("div",{onClick:()=>A(s._id),children:"Manage"})}]},placement:"bottomLeft",children:e.jsx(U,{className:"text-bold"})})})}));v(l)}catch(a){console.error("Error fetching group data:",a)}})()},[]);const O=async t=>{try{o([]);const a=await d.get(`/group/get-by-id-group-auction/${t}`);if(a.data.length>0){const l=a.data.map((s,n)=>({...s,slNo:n+1}));o(l)}else x()}catch(a){console.error("Error fetching group auction breakdown:",a),x()}},x=()=>{if(r.group_members){const t=Array.from({length:r.group_members},(a,l)=>({slNo:l+1,auctionDate:"",bidAmount:"",bidPercentage:"",commission:"",winningAmount:"",dividend:"",dividendPerHead:""}));o(t)}},A=async t=>{var a,l;y(t);try{const s=await d.get(`/group/get-by-id-group/${t}`),n=s.data;w(s.data),G({group_name:n.group_name,group_type:n.group_type,group_value:n.group_value,group_install:n.group_install,group_members:n.group_members,group_duration:n.group_duration,start_date:(a=n.start_date)==null?void 0:a.split("T")[0],end_date:(l=n.end_date)==null?void 0:l.split("T")[0],minimum_bid:n.minimum_bid,maximum_bid:n.maximum_bid,commission:n.commission,reg_fee:n.reg_fee}),p(!0)}catch(s){console.error("Error fetching group:",s)}},S=async()=>{try{if(await O(u),m.length===0&&r.group_members){const t=Array.from({length:r.group_members},(a,l)=>({slNo:l+1,auctionDate:"",bidAmount:"",bidPercentage:"",commission:"",winningAmount:"",dividend:"",dividendPerHead:""}));o(t),await d.post(`/group/create-group-break/${u}`,{auctionEntries:t})}c(!0)}catch(t){console.error("Error preparing auction breakdown:",t)}},b=(t,a,l)=>{const s=[...m];s[t]={...s[t],[a]:l},a==="bidPercentage"&&(s[t].bidAmount=(l/100*r.group_value).toFixed(1),s[t].commission=(r.commission/100*r.group_value).toFixed(1),s[t].winningAmount=(r.group_value-s[t].bidAmount).toFixed(1),s[t].dividend=(s[t].bidAmount-s[t].commission).toFixed(1),s[t].dividendPerHead=(s[t].dividend/r.group_members).toFixed(1)),o(s)},C=async t=>{t.preventDefault();try{const a={auctionEntries:m};(await d.put(`/group/update-group-break/${u}`,a,{headers:{"Content-Type":"application/json"}})).status===200?(alert("Auction breakdown saved successfully!"),window.location.reload()):alert("Failed to save auction breakdown!")}catch(a){console.error("Error updating auction breakdown:",a),alert("Failed to save auction breakdown!")}},E=[{key:"id",header:"SL. NO"},{key:"name",header:"Group Name"},{key:"type",header:"Group Type"},{key:"value",header:"Group Value"},{key:"installment",header:"Installment"},{key:"members",header:"Members"},{key:"action",header:"Action"}];return e.jsxs(e.Fragment,{children:[e.jsx(B,{visibility:!0,onGlobalSearchChangeHandler:D}),e.jsxs("div",{className:"flex mt-20",children:[e.jsx(M,{}),e.jsxs("div",{className:"flex-grow p-7",children:[e.jsx("div",{className:"mt-6 mb-8",children:e.jsx("h1",{className:"text-2xl font-semibold",children:"Group Breakdown"})}),e.jsx(F,{data:P(j,f),columns:E})]})]}),e.jsx(g,{isVisible:_,onClose:()=>p(!1),children:e.jsxs("div",{className:"py-6 px-5 lg:px-8 text-left w-full max-w-3xl mx-auto bg-white rounded-lg shadow-xl",children:[e.jsx("h3",{className:"mb-4 text-xl font-bold text-gray-900",children:"Update Group"}),e.jsxs("form",{className:"space-y-6 w-full",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm font-medium",children:"Group Name"}),e.jsx("input",{type:"text",value:r.group_name,readOnly:!0,className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm font-medium",children:"Group Type"}),e.jsx("input",{type:"text",value:r.group_type,readOnly:!0,className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm font-medium",children:"Group Value"}),e.jsx("input",{type:"text",value:r.group_value,readOnly:!0,className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm font-medium",children:"Group Installment"}),e.jsx("input",{type:"text",value:r.group_install,readOnly:!0,className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm font-medium",children:"Group Members"}),e.jsx("input",{type:"text",value:r.group_members,readOnly:!0,className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm font-medium",children:"Group Duration"}),e.jsx("input",{type:"text",value:r.group_duration,readOnly:!0,className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm font-medium",children:"Start Date"}),e.jsx("input",{type:"text",value:r.start_date,readOnly:!0,className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm font-medium",children:"End Date"}),e.jsx("input",{type:"text",value:r.end_date,readOnly:!0,className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm font-medium",children:"Minimum Bid"}),e.jsx("input",{type:"text",value:r.minimum_bid,readOnly:!0,className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm font-medium",children:"Maximum Bid"}),e.jsx("input",{type:"text",value:r.maximum_bid,readOnly:!0,className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm font-medium",children:"Commission (%)"}),e.jsx("input",{type:"text",value:r.commission,readOnly:!0,className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm font-medium",children:"Registration Fee"}),e.jsx("input",{type:"text",value:r.reg_fee,readOnly:!0,className:"input"})]})]}),e.jsx("div",{className:"flex justify-center mt-6",children:e.jsx("button",{type:"button",onClick:S,className:"px-6 py-2 bg-yellow-500 text-black rounded-lg",children:"Continue >"})})]})]})}),e.jsx(g,{isVisible:k,onClose:()=>c(!1),children:e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50",children:e.jsxs("div",{className:"bg-white w-[98vw] max-w-[98vw] p-8 rounded-lg shadow-xl overflow-y-auto h-[90vh]",children:[e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:()=>c(!1),className:"text-gray-500 hover:text-black text-2xl font-bold focus:outline-none",children:"Ã—"})}),e.jsx("h2",{className:"text-3xl font-bold mb-8 border-b pb-4",children:"Auction Breakdown"}),e.jsxs("form",{onSubmit:C,className:"space-y-12",children:[m.map((t,a)=>e.jsxs("div",{className:"space-y-8",children:[e.jsxs("h3",{className:"text-2xl font-semibold text-gray-700 mb-4",children:["Auction ",t.slNo]}),e.jsxs("div",{className:"grid grid-cols-4 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Sl.No"}),e.jsx("input",{type:"number",value:t.slNo,readOnly:!0,className:"w-full border rounded-md px-4 py-3 bg-gray-100 text-gray-800"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Auction Date"}),e.jsx("input",{type:"date",value:t.auctionDate,onChange:l=>b(a,"auctionDate",l.target.value),className:"w-full border rounded-md px-4 py-3"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Bid Percentage"}),e.jsx("input",{type:"number",value:t.bidPercentage,onChange:l=>b(a,"bidPercentage",l.target.value),className:"w-full border rounded-md px-4 py-3"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Bid Amount"}),e.jsx("input",{type:"number",value:t.bidAmount,readOnly:!0,className:"w-full border rounded-md px-4 py-3 bg-gray-100 text-gray-800"})]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Commission"}),e.jsx("input",{type:"number",value:t.commission,readOnly:!0,className:"w-full border rounded-md px-4 py-3 bg-gray-100 text-gray-800"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Winning Amount"}),e.jsx("input",{type:"number",value:t.winningAmount,readOnly:!0,className:"w-full border rounded-md px-4 py-3 bg-gray-100 text-gray-800"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Dividend"}),e.jsx("input",{type:"number",value:t.dividend,readOnly:!0,className:"w-full border rounded-md px-4 py-3 bg-gray-100 text-gray-800"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Dividend Per Head"}),e.jsx("input",{type:"number",value:t.dividendPerHead,readOnly:!0,className:"w-full border rounded-md px-4 py-3 bg-gray-100 text-gray-800"})]})]})]},a)),e.jsx("div",{className:"flex justify-center mt-10",children:e.jsx("button",{type:"submit",className:"bg-blue-700 hover:bg-blue-800 text-white font-bold py-4 px-10 rounded-lg text-xl",children:"Save Breakdown"})})]})]})})})]})};export{I as default};
