import{r as l,j as e,N as ue,e as n,D as xe,f as he,l as be,c as S,b as m}from"./index-DAP0bqfI.js";const pe=()=>{var M,P,I,$,T;const[k,R]=l.useState([]),[x,V]=l.useState([]);l.useState(""),l.useState("");const[W,B]=l.useState(""),[b,H]=l.useState(""),[C,q]=l.useState([]),[O,g]=l.useState([]),[i,y]=l.useState({}),[z,D]=l.useState(!1),[J,F]=l.useState(!1),[p,A]=l.useState(null),[K,Q]=l.useState(!1),[s,ge]=l.useState(null);l.useState(!1);const[f,X]=l.useState(""),[Y,Z]=l.useState("cash"),[j,G]=l.useState(()=>new Date().toISOString().split("T")[0]),[_,U]=l.useState(""),[v,ee]=l.useState(""),[te,E]=l.useState([]),[ae,se]=l.useState(""),le=t=>{const{value:a}=t.target;se(a)},[d,u]=l.useState({group_id:"",user_id:"",ticket:"",receipt_no:"",pay_date:"",amount:"",pay_type:"cash",transaction_id:""});l.useEffect(()=>{(async()=>{try{const a=await m.get("/group/get-group-admin");R(a.data)}catch(a){console.error("Error fetching group data:",a)}})()},[]),l.useEffect(()=>{(async()=>{try{const a=await m.get("/payment/get-latest-receipt");X(a.data)}catch(a){console.error("Error fetching receipt data:",a)}})()},[]),l.useEffect(()=>{f&&u(t=>({...t,receipt_no:f.receipt_no}))},[f]);const N=t=>{const{name:a,value:r}=t.target;u(c=>({...c,[a]:r}))},re=t=>{const{name:a,value:r}=t.target,[c,h]=r.split("-");u(o=>({...o,user_id:c,ticket:h}))};l.useEffect(()=>{(async()=>{try{const a=await m.get("/user/get-user");q(a.data)}catch(a){console.error("Error fetching group data:",a)}})()},[]);const oe=async t=>{const a=t.target.value;if(B(a),u(r=>({...r,group_id:a})),handleGroupChange(a),a)try{const r=await m.get(`/group/get-by-id-group/${a}`);y(r.data||{})}catch(r){console.error("Error fetching group data:",r),y({})}else y({})},ne=t=>{H(t)};l.useEffect(()=>{(async()=>{try{const a=await m.get("/payment/get-report-daybook",{params:{pay_date:j,groupId:b,userId:v,pay_type:_}});if(a.data&&a.data.length>0){g(a.data);const c=a.data.reduce((o,w)=>o+Number(w.amount||0),0);E(c||0);const h=a.data.map((o,w)=>{var L;return{_id:o._id,id:w+1,group:o.group_id.group_name,name:(L=o.user_id)==null?void 0:L.full_name,phone_number:o.user_id.phone_number,ticket:o.ticket,receipt:o.receipt_no?o.receipt_no:`#${o.old_receipt_no.split("-")[1]}`,amount:o.amount,mode:o.pay_type,collected_by:(o==null?void 0:o.collected_name)||"Admin"}});V(h)}else g([])}catch(a){console.error("Error fetching payment data:",a),g([]),E(0)}})()},[b,j,_,v]);const de=[{key:"id",header:"SL. NO"},{key:"group",header:"Group Name"},{key:"name",header:"Customer Name"},{key:"phone_number",header:"Customer Phone Number"},{key:"ticket",header:"Ticket"},{key:"receipt",header:"Receipt"},{key:"amount",header:"Amount"},{key:"mode",header:"Payment Mode"},{key:"collected_by",header:"Collected By"}];l.useEffect(()=>{if(i&&d.bid_amount){const t=i.group_value*5/100||0,a=(i.group_value||0)-(d.bid_amount||0),r=(d.bid_amount||0)-t,c=i.group_members?r/i.group_members:0,h=(i.group_install||0)-c;u(o=>({...o,group_id:i._id,commission:t,win_amount:a,divident:r,divident_head:c,payable:h}))}},[i,d.bid_amount]);const ce=t=>{const a=t.target.value;Z(a),u(r=>({...r,pay_type:a,transaction_id:a==="online"?r.transaction_id:""}))},ie=async t=>{t.preventDefault();try{(await m.post("/payment/add-payment",d)).status===201&&(alert("Payment Added Successfully"),D(!1))}catch(a){console.error("Error submitting payment data:",a)}},me=async()=>{if(p)try{await m.delete(`/payment/delete-payment/${p._id}`),alert("Payment deleted successfully"),F(!1),A(null),window.location.reload()}catch(t){console.error("Error deleting auction:",t)}};return e.jsx(e.Fragment,{children:e.jsx("div",{className:"w-screen",children:e.jsxs("div",{className:"flex mt-20",children:[e.jsx(ue,{onGlobalSearchChangeHandler:le,visibility:!0}),e.jsxs("div",{className:"flex-grow p-7",children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Reports - Daybook"}),e.jsxs("div",{className:"mt-6 mb-8",children:[e.jsx("div",{className:"mb-2",children:e.jsxs("div",{className:"flex justify-start items-center w-full gap-4",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{children:"Date"}),e.jsx("input",{type:"date",value:j,onChange:t=>G(t.target.value),className:"border border-gray-300 rounded px-4 py-2 shadow-sm outline-none w-full max-w-xs"})]}),e.jsxs("div",{className:"mb-2 flex flex-col",children:[e.jsx("label",{children:"Group"}),e.jsxs(n,{showSearch:!0,popupMatchSelectWidth:!1,value:b||void 0,onChange:ne,placeholder:"Search Or Select Group",filterOption:(t,a)=>a.children.toString().toLowerCase().includes(t.toLowerCase()),className:"w-full max-w-xs h-11",children:[e.jsx(n.Option,{value:"",children:"All"}),k.map(t=>e.jsx(n.Option,{value:t._id,children:t.group_name},t._id))]})]}),e.jsxs("div",{className:"mb-2 flex flex-col",children:[e.jsx("label",{children:"Customers"}),e.jsxs(n,{showSearch:!0,popupMatchSelectWidth:!1,value:v||void 0,filterOption:(t,a)=>a.children.toString().toLowerCase().includes(t.toLowerCase()),placeholder:"Search Or Select Customer",onChange:t=>ee(t),className:"w-full max-w-xs h-11",children:[e.jsx(n.Option,{value:"",children:"All"}),C.map(t=>e.jsxs(n.Option,{value:t==null?void 0:t._id,children:[t==null?void 0:t.full_name," - ",t.phone_number]},t==null?void 0:t._id))]})]}),e.jsxs("div",{className:"mb-2 flex flex-col",children:[e.jsx("label",{children:"Payment Mode"}),e.jsxs(n,{value:_||void 0,showSearch:!0,placeholder:"Search Or Select Payment",popupMatchSelectWidth:!1,onChange:t=>U(t),filterOption:(t,a)=>a.children.toString().toLowerCase().includes(t.toLowerCase()),className:"w-full max-w-xs h-11",children:[e.jsx(n.Option,{value:"",children:"All"}),e.jsx(n.Option,{value:"cash",children:"Cash"}),e.jsx(n.Option,{value:"online",children:"Online"})]})]}),e.jsx("div",{children:e.jsxs("h1",{className:"text-md mt-6",children:["Total Amount:"," ",e.jsxs("span",{className:"text-xl",children:["â‚¹",te+0]})]})})]})}),O&&O.length>0?e.jsx("div",{className:"mt-10",children:e.jsx(xe,{data:he(x,ae),columns:de,exportedFileName:`Daybook-${x.length>0?x[0].name+" to "+x[x.length-1].name:"empty"}.csv`})}):e.jsx(be,{})]})]}),e.jsx(S,{isVisible:z,onClose:()=>D(!1),children:e.jsxs("div",{className:"py-6 px-5 lg:px-8 text-left",children:[e.jsx("h3",{className:"mb-4 text-xl font-bold text-gray-900",children:"Add Payment"}),e.jsxs("form",{className:"space-y-6",onSubmit:ie,children:[e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"category",children:"Group"}),e.jsxs("select",{value:W,onChange:oe,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5",children:[e.jsx("option",{value:"",children:"Select Group"}),k.map(t=>e.jsx("option",{value:t._id,children:t.group_name},t._id))]})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"category",children:"Customers"}),e.jsxs(n,{name:"user_id",value:`${d.user_id}-${d.ticket}`,onChange:re,required:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5",children:[e.jsx(n.Option,{value:"",children:"Select Customer"}),C.map(t=>{var a,r,c;return e.jsxs(n.Option,{value:`${(a=t==null?void 0:t.user_id)==null?void 0:a._id}-${t.tickets}`,children:[(r=t==null?void 0:t.user_id)==null?void 0:r.full_name," | ",t.tickets]},`${(c=t==null?void 0:t.user_id)==null?void 0:c._id}-${t.tickets}`)})]})]}),e.jsxs("div",{className:"flex flex-row justify-between space-x-4",children:[e.jsxs("div",{className:"w-1/2",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"group_value",children:"Receipt No."}),e.jsx("input",{type:"text",name:"receipt_no",value:d.receipt_no,id:"receipt_no",placeholder:"Receipt No.",readOnly:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5"})]}),e.jsxs("div",{className:"w-1/2",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"group_install",children:"Payment Date"}),e.jsx("input",{type:"date",name:"pay_date",value:d.pay_date,id:"pay_date",onChange:N,placeholder:"",className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5"})]})]}),e.jsxs("div",{className:"flex flex-row justify-between space-x-4",children:[e.jsxs("div",{className:"w-1/2",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"group_value",children:"Amount"}),e.jsx("input",{type:"text",name:"amount",value:d.amount,id:"amount",onChange:N,placeholder:"Enter Amount",className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5"})]}),e.jsxs("div",{className:"w-1/2",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"pay_mode",children:"Payment Mode"}),e.jsxs("select",{name:"pay_mode",id:"pay_mode",className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5",onChange:ce,children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"online",children:"Online"})]})]})]}),Y==="online"&&e.jsxs("div",{className:"w-full mt-4",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"transaction_id",children:"Transaction ID"}),e.jsx("input",{type:"text",name:"transaction_id",id:"transaction_id",value:d.transaction_id,onChange:N,placeholder:"Enter Transaction ID",className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5"})]}),e.jsx("button",{type:"submit",className:`w-full text-white bg-blue-700 hover:bg-blue-800
                              focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center`,children:"Add"})]})]})}),e.jsx(S,{isVisible:K,onClose:()=>Q(!1),children:e.jsxs("div",{className:"py-6 px-5 lg:px-8 text-left",children:[e.jsx("h3",{className:"mb-4 text-xl font-bold text-gray-900",children:"View Auction"}),e.jsxs("form",{className:"space-y-6",onSubmit:()=>{},children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"email",children:"Group"}),e.jsx("input",{type:"text",name:"group_id",value:(M=s==null?void 0:s.group_id)==null?void 0:M.group_name,onChange:()=>{},id:"name",placeholder:"Enter the Group Name",readOnly:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5"})]}),e.jsxs("div",{className:"flex flex-row justify-between space-x-4",children:[e.jsxs("div",{className:"w-1/2",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"group_value",children:"Group Value"}),e.jsx("input",{type:"text",name:"group_value",value:(P=s==null?void 0:s.group_id)==null?void 0:P.group_value,id:"group_value",placeholder:"select group to check",readOnly:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5"})]}),e.jsxs("div",{className:"w-1/2",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"group_install",children:"Group Installment"}),e.jsx("input",{type:"text",name:"group_install",value:(I=s==null?void 0:s.group_id)==null?void 0:I.group_install,id:"group_install",placeholder:"select group to check",readOnly:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"email",children:"User"}),e.jsx("input",{type:"text",name:"group_id",value:`${($=s==null?void 0:s.user_id)==null?void 0:$.full_name} | ${s==null?void 0:s.ticket}`,onChange:()=>{},id:"name",placeholder:"Enter the User Name",readOnly:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"email",children:"Bid Amount"}),e.jsx("input",{type:"number",name:"bid_amount",value:((T=s==null?void 0:s.group_id)==null?void 0:T.group_value)-(s==null?void 0:s.win_amount),onChange:()=>{},id:"name",placeholder:"Enter the Bid Amount",readOnly:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5"})]}),e.jsxs("div",{className:"flex flex-row justify-between space-x-4",children:[e.jsxs("div",{className:"w-1/2",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"group_value",children:"Commission"}),e.jsx("input",{type:"text",name:"commission",value:s==null?void 0:s.commission,id:"commission",placeholder:"",readOnly:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5"})]}),e.jsxs("div",{className:"w-1/2",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"group_install",children:"Winning Amount"}),e.jsx("input",{type:"text",name:"win_amount",value:s==null?void 0:s.win_amount,id:"win_amount",placeholder:"",readOnly:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5"})]})]}),e.jsxs("div",{className:"flex flex-row justify-between space-x-4",children:[e.jsxs("div",{className:"w-1/2",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"group_value",children:"Divident"}),e.jsx("input",{type:"text",name:"divident",value:s==null?void 0:s.divident,id:"divident",placeholder:"",readOnly:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5"})]}),e.jsxs("div",{className:"w-1/2",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"group_install",children:"Divident per Head"}),e.jsx("input",{type:"text",name:"divident_head",value:s==null?void 0:s.divident_head,id:"divident_head",placeholder:"",readOnly:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5"})]}),e.jsxs("div",{className:"w-1/2",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"group_install",children:"Next Payable"}),e.jsx("input",{type:"text",name:"payable",value:s==null?void 0:s.payable,id:"payable",placeholder:"",readOnly:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5"})]})]}),e.jsxs("div",{className:"flex flex-row justify-between space-x-4",children:[e.jsxs("div",{className:"w-1/2",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"date",children:"Auction Date"}),e.jsx("input",{type:"date",name:"auction_date",value:s==null?void 0:s.auction_date,onChange:()=>{},id:"date",placeholder:"Enter the Date",readOnly:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5"})]}),e.jsxs("div",{className:"w-1/2",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"date",children:"Next Date"}),e.jsx("input",{type:"date",name:"next_date",value:s==null?void 0:s.next_date,onChange:()=>{},id:"date",placeholder:"Enter the Date",readOnly:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5"})]})]})]})]})}),e.jsx(S,{isVisible:J,onClose:()=>{F(!1),A(null)},children:e.jsxs("div",{className:"py-6 px-5 lg:px-8 text-left",children:[e.jsx("h3",{className:"mb-4 text-xl font-bold text-gray-900",children:"Sure want to delete this Payment ?"}),p&&e.jsx("form",{onSubmit:t=>{t.preventDefault(),me()},className:"space-y-6",children:e.jsx("button",{type:"submit",className:`w-full text-white bg-red-700 hover:bg-red-800
                    focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center`,children:"Delete"})})]})})]})})})};export{pe as default};
