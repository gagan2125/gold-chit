import{r,b as n,j as e,N as ne,S as oe,C as ie,e as O,D as ce,c as T,g as de,d as ue,I as me}from"./index-DAP0bqfI.js";const ge=()=>{const[b,L]=r.useState([]),[F,q]=r.useState([]),[d,V]=r.useState([]),[he,x]=r.useState([]),[g,P]=r.useState(""),[W,y]=r.useState(!1),[H,j]=r.useState(!1),[I,R]=r.useState(null),[z,D]=r.useState([]),[B,_]=r.useState(!1),[v,N]=r.useState(null),[o,J]=r.useState([]),[k,U]=r.useState(!1),[i,p]=r.useState({}),K=!0,[w,S]=r.useState({visibility:!1,message:"Something went wrong!",type:"info"}),[c,M]=r.useState({group_id:"",user_id:"",no_of_tickets:""}),[u,A]=r.useState({group_id:"",user_id:"",tickets:""}),[Q,X]=r.useState(""),Y=t=>{const{value:s}=t.target;X(s)};r.useEffect(()=>{(async()=>{try{const s=await n.get("/group/get-group-admin");console.log(s),L(s.data)}catch(s){console.error("Error fetching group data:",s)}})()},[]),r.useEffect(()=>{(async()=>{try{const s=await n.get("/user/get-user");console.log(s),q(s.data)}catch(s){console.error("Error fetching user data:",s)}})()},[]);const Z=async t=>{if(P(t),t)try{const s=await n.get(`/enroll/get-group-enroll/${t}`);if(s.data&&s.data.length>0){x(s.data);const a=s.data.map((l,G)=>{var f,m;return{_id:l==null?void 0:l._id,id:G+1,name:(f=l==null?void 0:l.user_id)==null?void 0:f.full_name,phone_number:(m=l==null?void 0:l.user_id)==null?void 0:m.phone_number,ticket:l.tickets,action:e.jsx("div",{className:"flex justify-center items-center gap-2",children:e.jsx(ue,{menu:{items:[{key:"1",label:e.jsx("div",{className:"text-green-600",onClick:()=>$(l._id),children:"Edit"})},{key:"2",label:e.jsx("div",{className:"text-red-600",onClick:()=>le(l._id),children:"Delete"})}]},placement:"bottomLeft",children:e.jsx(me,{className:"text-bold"})})})}});V(a)}else x([])}catch(s){console.error("Error fetching enrollment data:",s),x([])}else x([])},ee=[{key:"id",header:"SL. NO"},{key:"name",header:"Customer Name"},{key:"phone_number",header:"Customer Phone Number"},{key:"ticket",header:"Ticket Number"},{key:"action",header:"Action"}],C=async t=>{const{name:s,value:a}=t.target;if(M(l=>({...l,[s]:a})),p(l=>({...l,[s]:""})),s==="group_id")try{const l=await n.post(`/enroll/get-next-tickets/${a}`);J(l.data.availableTickets||[]),console.log("Next tickets:",l.data.availableTickets)}catch(l){console.error("Error fetching next tickets:",l)}},te=t=>{const s={},a=c,l="no_of_tickets";return a.group_id.trim()||(s.group_id="Please select a group"),a.user_id||(s.user_id="Please select a customer"),o.length>0&&(!a[l]||a[l]<=0||isNaN(a[l])?s[l]="Please enter number of tickets":a[l]>o.length&&(s[l]=`Maximum ${o.length} tickets allowed`)),p(s),Object.keys(s).length===0},se=async t=>{if(t.preventDefault(),te()){U(!0);const{no_of_tickets:a,group_id:l,user_id:G}=c,f=parseInt(a,10),m=o.slice(0,f).map(h=>({group_id:l,user_id:G,no_of_tickets:a,tickets:h}));console.log(m);try{for(const h of m)console.log("ticket"),await n.post("/enroll/add-enroll",h,{headers:{"Content-Type":"application/json"}});y(!1),M({group_id:"",user_id:"",no_of_tickets:""}),S({visibility:!0,message:"User Enrolled Successfully",type:"success"})}catch(h){console.error("Error enrolling user:",h)}finally{U(!1)}}},E=t=>{const{name:s,value:a}=t.target;A(l=>({...l,[s]:a}))},$=async t=>{try{const s=await n.get(`/enroll/get-enroll-by-id/${t}`);R(s.data),A({group_id:s.data.group_id._id,user_id:s.data.user_id._id,tickets:s.data.tickets}),j(!0)}catch(s){console.error("Error fetching enrollment:",s)}},le=async t=>{try{const s=await n.get(`/enroll/get-enroll-by-id/${t}`);N(s.data),_(!0)}catch(s){console.error("Error fetching enroll:",s)}},re=async()=>{if(v)try{await n.delete(`/enroll/delete-enroll/${v._id}`),_(!1),N(null),S({visibility:!0,message:"Enroll deleted successfully",type:"success"})}catch(t){console.error("Error deleting group:",t)}},ae=async t=>{t.preventDefault();try{await n.put(`/enroll/update-enroll/${I._id}`,u),j(!1),S({visibility:!0,message:"Enrollment Updated Successfully",type:"success"})}catch(s){console.error("Error updating enroll:",s)}};return r.useEffect(()=>{g?n.post(`/enroll/get-next-tickets/${g}`).then(t=>{D(t.data.availableTickets||[])}).catch(t=>{console.error("Error fetching available tickets:",t)}):D([])},[g]),e.jsx(e.Fragment,{children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex mt-20",children:[e.jsx(ne,{onGlobalSearchChangeHandler:Y,visibility:!0}),e.jsx(oe,{}),e.jsx(ie,{type:w.type,isVisible:w.visibility,message:w.message}),e.jsxs("div",{className:"flex-grow p-7",children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Enrollments"}),e.jsxs("div",{className:"mt-6 mb-8",children:[e.jsx("div",{className:"mb-2",children:e.jsx("label",{children:"Search or Select Group"})}),e.jsxs("div",{className:"flex justify-between items-center w-full",children:[e.jsx(O,{showSearch:!0,popupMatchSelectWidth:!1,value:g||void 0,filterOption:(t,s)=>s.children.toString().toLowerCase().includes(t.toLowerCase()),placeholder:"Search or Select Group",onChange:Z,className:"border   w-full max-w-md",children:b.map(t=>e.jsx(O.Option,{value:t._id,children:t.group_name},t._id))}),e.jsx("button",{onClick:()=>y(!0),className:`ml-4 bg-blue-800 text-white px-4 py-2 rounded shadow-md hover:bg-yellow-500
                  
                  
                  transition duration-200`,children:"+ Add Enrollment"})]})]}),e.jsx(ce,{updateHandler:$,data:d.filter(t=>Object.values(t).some(s=>String(s).toLowerCase().includes(Q.toLowerCase()))),columns:ee,exportedFileName:`Enrollments-${d.length>0?d[0].name+" to "+d[d.length-1].name:"empty"}.csv`})]})]}),e.jsx(T,{isVisible:W,onClose:()=>{y(!1),p({})},children:e.jsxs("div",{className:"py-6 px-5 lg:px-8 text-left",children:[e.jsx("h3",{className:"mb-4 text-xl font-bold text-gray-900",children:"Add Enrollment"}),e.jsxs("form",{className:"space-y-6",onSubmit:se,noValidate:!0,children:[e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"category",children:"Group"}),e.jsxs("select",{name:"group_id",id:"group_id",value:c.group_id,onChange:C,required:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5",children:[e.jsx("option",{value:"",children:"Select Group"}),b.map(t=>e.jsx("option",{value:t._id,children:t.group_name},t._id))]}),i.group_id&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:i.group_id})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"category",children:"Customer"}),e.jsxs("select",{name:"user_id",id:"user_id",value:c.user_id,onChange:C,required:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5",children:[e.jsx("option",{value:"",children:"Select Customer"}),F.map(t=>e.jsx("option",{value:t._id,children:t.full_name},t._id))]}),i.user_id&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:i.user_id})]}),c.group_id&&o.length===0?e.jsx(e.Fragment,{children:e.jsx("p",{className:"text-center text-red-600",children:"Group is Full"})}):c.group_id&&o.length!==0?e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"email",children:"Number of Tickets"}),e.jsx("input",{type:"number",name:"no_of_tickets",value:c.no_of_tickets,id:"name",onChange:t=>{C(t)},placeholder:"Enter the Number of Tickets",required:!0,max:o.length,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5"}),i.no_of_tickets&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:i.no_of_tickets}),e.jsxs("span",{className:"mt-10 flex items-center justify-center text-sm text-blue-900",children:["Only ",o.length," tickets left"]})]}):e.jsx("p",{className:"text-center text-red-600"}),e.jsxs("div",{className:"flex flex-col items-center p-4 max-w-full bg-white rounded-lg shadow-sm space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(de,{color:"green",className:"w-10 h-10"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"WhatsApp"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:K,className:"text-green-500 checked:ring-2  checked:ring-green-700  rounded-full w-4 h-4"}),e.jsx("span",{className:"text-gray-700",children:"Send Via Whatsapp"})]})]}),e.jsx("button",{type:"submit",disabled:k||o.length===0,className:`w-full text-white font-medium rounded-lg text-sm px-5 py-2.5 text-center ${k?"bg-gray-400 cursor-not-allowed":"bg-blue-700 hover:bg-yellow-500 focus:ring-4 focus:outline-none focus:ring-blue-300"}`,children:k?e.jsx(e.Fragment,{children:e.jsx("p",{children:"Loading..."})}):e.jsx(e.Fragment,{children:"Add"})})]})]})}),e.jsx(T,{isVisible:H,onClose:()=>{j(!1),p({})},children:e.jsxs("div",{className:"py-6 px-5 lg:px-8 text-left",children:[e.jsx("h3",{className:"mb-4 text-xl font-bold text-gray-900",children:"Update Enrollment"}),e.jsxs("form",{className:"space-y-6",onSubmit:ae,children:[e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"group_id",children:"Group"}),e.jsxs("select",{name:"group_id",id:"group_id",value:u.group_id,onChange:E,required:!0,disabled:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5",children:[e.jsx("option",{value:"",children:"Select Group"}),b.map(t=>e.jsx("option",{value:t._id,children:t.group_name},t._id))]})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"user_id",children:"Customer"}),e.jsxs("select",{name:"user_id",id:"user_id",value:u.user_id,onChange:E,required:!0,disabled:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5",children:[e.jsx("option",{value:"",children:"Select Customer"}),F.map(t=>e.jsx("option",{value:t._id,children:t.full_name},t._id))]}),i.user_id&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:i.user_id})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"no_of_tickets",children:"Select Ticket"}),e.jsxs("select",{name:"tickets",value:u.tickets,onChange:E,id:"no_of_tickets",required:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5",children:[e.jsx("option",{value:"",children:"Select Ticket"}),z.concat([u.tickets]).map((t,s)=>e.jsx("option",{value:t,children:t},s))]})]}),e.jsx("button",{type:"submit",className:"w-full text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center",children:"Update"})]})]})}),e.jsx(T,{isVisible:B,onClose:()=>{_(!1),N(null)},children:e.jsxs("div",{className:"py-6 px-5 lg:px-8 text-left",children:[e.jsx("h3",{className:"mb-4 text-xl font-bold text-gray-900",children:"Sure want to remove this Enrollment ?"}),v&&e.jsx("form",{onSubmit:t=>{t.preventDefault(),re()},className:"space-y-6",children:e.jsx("button",{type:"submit",className:`w-full text-white bg-red-700 hover:bg-red-800
          focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center`,children:"Remove"})})]})})]})})};export{ge as default};
