import{r as l,j as e,N as ge,C as ye,D as pe,f as fe,l as je,c as k,b as c}from"./index-DAP0bqfI.js";const we=()=>{var M,I,R,T,$;const[C,L]=l.useState([]),[u,H]=l.useState([]);l.useState(""),l.useState("");const[q,W]=l.useState(""),[b,z]=l.useState(""),[D,G]=l.useState([]),[F,h]=l.useState([]),[i,g]=l.useState({}),[J,E]=l.useState(!1),[K,A]=l.useState(!1),[y,P]=l.useState(null),[Q,X]=l.useState(!1),[s,_e]=l.useState(null);l.useState(!1);const[p,Y]=l.useState(""),[Z,U]=l.useState("cash"),[ee,te]=l.useState(""),ae=t=>{te(t.target.value)},[f,se]=l.useState(()=>new Date().toISOString().split("T")[0]),[j,le]=l.useState(()=>new Date().toISOString().split("T")[0]),[_,re]=l.useState(""),[v,ne]=l.useState(""),[oe,O]=l.useState([]),[o,m]=l.useState({group_id:"",user_id:"",ticket:"",receipt_no:"",pay_date:"",amount:"",pay_type:"cash",transaction_id:""}),[N,ve]=l.useState({visibility:!1,message:"Something went wrong!",type:"info"});l.useEffect(()=>{(async()=>{try{const a=await c.get("/group/get-group-admin");L(a.data)}catch(a){console.error("Error fetching group data:",a)}})()},[]),l.useEffect(()=>{(async()=>{try{const a=await c.get("/payment/get-latest-receipt");Y(a.data)}catch(a){console.error("Error fetching receipt data:",a)}})()},[]),l.useEffect(()=>{p&&m(t=>({...t,receipt_no:p.receipt_no}))},[p]);const w=t=>{const{name:a,value:r}=t.target;m(d=>({...d,[a]:r}))},de=t=>{const{name:a,value:r}=t.target,[d,x]=r.split("-");m(n=>({...n,user_id:d,ticket:x}))};l.useEffect(()=>{(async()=>{try{const a=await c.get("/user/get-user");G(a.data)}catch(a){console.error("Error fetching group data:",a)}})()},[]);const ie=async t=>{const a=t.target.value;if(W(a),m(r=>({...r,group_id:a})),handleGroupChange(a),a)try{const r=await c.get(`/group/get-by-id-group/${a}`);g(r.data||{})}catch(r){console.error("Error fetching group data:",r),g({})}else g({})},ce=async t=>{const a=t.target.value;z(a),handleGroupChange(a)},me=t=>{const a=new Date(t),r={day:"numeric",month:"short",year:"numeric"};return a.toLocaleDateString("en-US",r).replace(",","")};l.useEffect(()=>{(async()=>{try{const a=await c.get("/payment/get-report-receipt",{params:{from_date:f,to_date:j,groupId:b,userId:v,pay_type:_}});if(a.data&&a.data.length>0){const r=a.data.filter(n=>n.group_id!==null);h(r),console.log("payment:",r);const d=r.reduce((n,S)=>n+Number(S.amount||0),0);O(d);const x=r.map((n,S)=>{var V,B;return{_id:n._id,id:S+1,date:me(n.pay_date),group:n.group_id.group_name,name:(V=n.user_id)==null?void 0:V.full_name,phone_number:(B=n.user_id)==null?void 0:B.phone_number,receipt_no:n!=null&&n.receipt_no?n.receipt_no:`#${n.old_receipt_no.split("-")[1]}`,ticket:n.ticket,amount:n.amount,mode:n.pay_type,collected_by:(n==null?void 0:n.collected_name)||"Admin"}});H(x)}else h([])}catch(a){console.error("Error fetching payment data:",a),h([]),O(0)}})()},[b,j,_,v,f]);const ue=[{key:"id",header:"SL. NO"},{key:"date",header:"Date"},{key:"group",header:"Group Name"},{key:"name",header:"Customer Name"},{key:"phone_number",header:"Customer Phone Number"},{key:"receipt_no",header:"Receipt Number"},{key:"ticket",header:"Ticket"},{key:"amount",header:"Amount"},{key:"mode",header:"Payment Mode"},{key:"collected_by",header:"Collected By"}];l.useEffect(()=>{if(i&&o.bid_amount){const t=i.group_value*5/100||0,a=(i.group_value||0)-(o.bid_amount||0),r=(o.bid_amount||0)-t,d=i.group_members?r/i.group_members:0,x=(i.group_install||0)-d;m(n=>({...n,group_id:i._id,commission:t,win_amount:a,divident:r,divident_head:d,payable:x}))}},[i,o.bid_amount]);const xe=t=>{const a=t.target.value;U(a),m(r=>({...r,pay_type:a,transaction_id:a==="online"?r.transaction_id:""}))},be=async t=>{t.preventDefault();try{(await c.post("/payment/add-payment",o)).status===201&&(alert("Payment Added Successfully"),E(!1))}catch(a){console.error("Error submitting payment data:",a)}},he=async()=>{if(y)try{await c.delete(`/payment/delete-payment/${y._id}`),alert("Payment deleted successfully"),A(!1),P(null),window.location.reload()}catch(t){console.error("Error deleting auction:",t)}};return e.jsx(e.Fragment,{children:e.jsx("div",{className:"w-screen",children:e.jsxs("div",{className:"flex mt-20",children:[e.jsx(ge,{onGlobalSearchChangeHandler:ae,visibility:!0}),e.jsx(ye,{type:N.type,isVisible:N.visibility,message:N.message}),e.jsxs("div",{className:"flex-grow p-7",children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Reports - Receipt"}),e.jsxs("div",{className:"mt-6 mb-8",children:[e.jsx("div",{className:"mb-2",children:e.jsxs("div",{className:"flex justify-start items-center w-full gap-4",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{children:"From Date"}),e.jsx("input",{type:"date",value:f,onChange:t=>se(t.target.value),className:"border border-gray-300 rounded px-4 py-2 shadow-sm outline-none w-full max-w-xs"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{children:"To Date"}),e.jsx("input",{type:"date",value:j,onChange:t=>le(t.target.value),className:"border border-gray-300 rounded px-4 py-2 shadow-sm outline-none w-full max-w-xs"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{children:"Group"}),e.jsxs("select",{value:b,onChange:ce,className:"border border-gray-300 rounded px-6 py-2 shadow-sm outline-none w-full max-w-md",children:[e.jsx("option",{value:"",children:"Select Group"}),C.map(t=>e.jsx("option",{value:t._id,children:t.group_name},t._id))]})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{children:"Customer"}),e.jsxs("select",{value:v,onChange:t=>ne(t.target.value),className:"border border-gray-300 rounded px-6 py-2 shadow-sm outline-none w-full max-w-md",children:[e.jsx("option",{value:"",children:"Select Customer"}),D.map(t=>e.jsxs("option",{value:t==null?void 0:t._id,children:[t==null?void 0:t.full_name," - ",t.phone_number]},t==null?void 0:t._id))]})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{children:"Payment Mode"}),e.jsxs("select",{value:_,onChange:t=>re(t.target.value),className:"border border-gray-300 rounded px-6 py-2 shadow-sm outline-none w-full max-w-md",children:[e.jsx("option",{value:"",children:"Select Payment Mode"}),e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"online",children:"Online"})]})]}),e.jsx("div",{children:e.jsxs("h1",{className:"text-md mt-6",children:["Total Amount:"," ",e.jsxs("span",{className:"text-xl",children:["â‚¹",oe||0]})]})})]})}),F&&F.length>0?e.jsx("div",{className:"mt-10",children:e.jsx(pe,{data:fe(u,ee),columns:ue,exportedFileName:`ReportsReceipt-${u.length>0?u[0].name+" to "+u[u.length-1].name:"empty"}.csv`})}):e.jsx("div",{className:"mt-10 text-center text-gray-500",children:e.jsx(je,{})})]})]}),e.jsx(k,{isVisible:J,onClose:()=>E(!1),children:e.jsxs("div",{className:"py-6 px-5 lg:px-8 text-left",children:[e.jsx("h3",{className:"mb-4 text-xl font-bold text-gray-900",children:"Add Payment"}),e.jsxs("form",{className:"space-y-6",onSubmit:be,children:[e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"category",children:"Group"}),e.jsxs("select",{value:q,onChange:ie,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5",children:[e.jsx("option",{value:"",children:"Select Group"}),C.map(t=>e.jsx("option",{value:t._id,children:t.group_name},t._id))]})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"category",children:"Customers"}),e.jsxs("select",{name:"user_id",value:`${o.user_id}-${o.ticket}`,onChange:de,required:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5",children:[e.jsx("option",{value:"",children:"Select Customer"}),D.map(t=>{var a,r,d;return e.jsxs("option",{value:`${(a=t==null?void 0:t.user_id)==null?void 0:a._id}-${t.tickets}`,children:[(r=t==null?void 0:t.user_id)==null?void 0:r.full_name," | ",t.tickets]},`${(d=t==null?void 0:t.user_id)==null?void 0:d._id}-${t.tickets}`)})]})]}),e.jsxs("div",{className:"flex flex-row justify-between space-x-4",children:[e.jsxs("div",{className:"w-1/2",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"group_value",children:"Receipt No."}),e.jsx("input",{type:"text",name:"receipt_no",value:o.receipt_no,id:"receipt_no",placeholder:"Receipt No.",readOnly:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5"})]}),e.jsxs("div",{className:"w-1/2",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"group_install",children:"Payment Date"}),e.jsx("input",{type:"date",name:"pay_date",value:o.pay_date,id:"pay_date",onChange:w,placeholder:"",className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5"})]})]}),e.jsxs("div",{className:"flex flex-row justify-between space-x-4",children:[e.jsxs("div",{className:"w-1/2",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"group_value",children:"Amount"}),e.jsx("input",{type:"text",name:"amount",value:o.amount,id:"amount",onChange:w,placeholder:"Enter Amount",className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5"})]}),e.jsxs("div",{className:"w-1/2",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"pay_mode",children:"Payment Mode"}),e.jsxs("select",{name:"pay_mode",id:"pay_mode",className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5",onChange:xe,children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"online",children:"Online"})]})]})]}),Z==="online"&&e.jsxs("div",{className:"w-full mt-4",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"transaction_id",children:"Transaction ID"}),e.jsx("input",{type:"text",name:"transaction_id",id:"transaction_id",value:o.transaction_id,onChange:w,placeholder:"Enter Transaction ID",className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5"})]}),e.jsx("button",{type:"submit",className:`w-full text-white bg-blue-700 hover:bg-blue-800
                              focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center`,children:"Add"})]})]})}),e.jsx(k,{isVisible:Q,onClose:()=>X(!1),children:e.jsxs("div",{className:"py-6 px-5 lg:px-8 text-left",children:[e.jsx("h3",{className:"mb-4 text-xl font-bold text-gray-900",children:"View Auction"}),e.jsxs("form",{className:"space-y-6",onSubmit:()=>{},children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"email",children:"Group"}),e.jsx("input",{type:"text",name:"group_id",value:(M=s==null?void 0:s.group_id)==null?void 0:M.group_name,onChange:()=>{},id:"name",placeholder:"Enter the Group Name",readOnly:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5"})]}),e.jsxs("div",{className:"flex flex-row justify-between space-x-4",children:[e.jsxs("div",{className:"w-1/2",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"group_value",children:"Group Value"}),e.jsx("input",{type:"text",name:"group_value",value:(I=s==null?void 0:s.group_id)==null?void 0:I.group_value,id:"group_value",placeholder:"select group to check",readOnly:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5"})]}),e.jsxs("div",{className:"w-1/2",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"group_install",children:"Group Installment"}),e.jsx("input",{type:"text",name:"group_install",value:(R=s==null?void 0:s.group_id)==null?void 0:R.group_install,id:"group_install",placeholder:"select group to check",readOnly:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"email",children:"User"}),e.jsx("input",{type:"text",name:"group_id",value:`${(T=s==null?void 0:s.user_id)==null?void 0:T.full_name} | ${s==null?void 0:s.ticket}`,onChange:()=>{},id:"name",placeholder:"Enter the User Name",readOnly:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"email",children:"Bid Amount"}),e.jsx("input",{type:"number",name:"bid_amount",value:(($=s==null?void 0:s.group_id)==null?void 0:$.group_value)-(s==null?void 0:s.win_amount),onChange:()=>{},id:"name",placeholder:"Enter the Bid Amount",readOnly:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5"})]}),e.jsxs("div",{className:"flex flex-row justify-between space-x-4",children:[e.jsxs("div",{className:"w-1/2",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"group_value",children:"Commission"}),e.jsx("input",{type:"text",name:"commission",value:s==null?void 0:s.commission,id:"commission",placeholder:"",readOnly:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5"})]}),e.jsxs("div",{className:"w-1/2",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"group_install",children:"Winning Amount"}),e.jsx("input",{type:"text",name:"win_amount",value:s==null?void 0:s.win_amount,id:"win_amount",placeholder:"",readOnly:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5"})]})]}),e.jsxs("div",{className:"flex flex-row justify-between space-x-4",children:[e.jsxs("div",{className:"w-1/2",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"group_value",children:"Divident"}),e.jsx("input",{type:"text",name:"divident",value:s==null?void 0:s.divident,id:"divident",placeholder:"",readOnly:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5"})]}),e.jsxs("div",{className:"w-1/2",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"group_install",children:"Divident per Head"}),e.jsx("input",{type:"text",name:"divident_head",value:s==null?void 0:s.divident_head,id:"divident_head",placeholder:"",readOnly:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5"})]}),e.jsxs("div",{className:"w-1/2",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"group_install",children:"Next Payable"}),e.jsx("input",{type:"text",name:"payable",value:s==null?void 0:s.payable,id:"payable",placeholder:"",readOnly:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5"})]})]}),e.jsxs("div",{className:"flex flex-row justify-between space-x-4",children:[e.jsxs("div",{className:"w-1/2",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"date",children:"Auction Date"}),e.jsx("input",{type:"date",name:"auction_date",value:s==null?void 0:s.auction_date,onChange:()=>{},id:"date",placeholder:"Enter the Date",readOnly:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5"})]}),e.jsxs("div",{className:"w-1/2",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"date",children:"Next Date"}),e.jsx("input",{type:"date",name:"next_date",value:s==null?void 0:s.next_date,onChange:()=>{},id:"date",placeholder:"Enter the Date",readOnly:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5"})]})]})]})]})}),e.jsx(k,{isVisible:K,onClose:()=>{A(!1),P(null)},children:e.jsxs("div",{className:"py-6 px-5 lg:px-8 text-left",children:[e.jsx("h3",{className:"mb-4 text-xl font-bold text-gray-900",children:"Sure want to delete this Payment ?"}),y&&e.jsx("form",{onSubmit:t=>{t.preventDefault(),he()},className:"space-y-6",children:e.jsx("button",{type:"submit",className:`w-full text-white bg-red-700 hover:bg-red-800
                    focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center`,children:"Delete"})})]})})]})})})};export{we as default};
