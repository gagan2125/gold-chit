import{r,j as e,N as me,e as be,D as xe,f as ge,l as he,c as N,b as i,n as ye}from"./index-DAP0bqfI.js";const _e=()=>{var A,C,D,F,O,E,$,M;const[w,B]=r.useState([]),[u,L]=r.useState([]),[pe,V]=r.useState(""),[fe,q]=r.useState(""),[P,R]=r.useState(""),[h,H]=r.useState(""),[W,b]=r.useState([]),[y,x]=r.useState([]),[d,p]=r.useState({}),[z,k]=r.useState(!1),[J,f]=r.useState(!1),[j,_]=r.useState(null),[K,S]=r.useState(!1),[a,Q]=r.useState(null),[X,Y]=r.useState({}),[Z,G]=r.useState(""),[n,v]=r.useState({group_id:"",user_id:"",ticket:"",bid_amount:"",commission:"",win_amount:"",divident:"",divident_head:"",payable:"",auction_date:"",next_date:"",group_type:"",auction_type:"normal"}),U=t=>{G(t.target.value)};r.useEffect(()=>{(async()=>{try{const l=await i.get("/group/get-group-admin");console.log(l),B(l.data)}catch(l){console.error("Error fetching group data:",l)}})()},[]),r.useEffect(()=>{(async()=>{try{const l=await i.get(`/double/get-double/${h}`);console.log(l.data),Y(l.data)}catch(l){console.error("Error fetching group data:",l)}})()},[h]);const g=t=>{const{name:l,value:s}=t.target;v(c=>({...c,[l]:s}))},ee=t=>{const{name:l,value:s}=t.target,[c,o]=s.split("-");v(m=>({...m,user_id:c,ticket:o}))},te=async t=>{if(V(t),t)try{const l=await i.get(`/enroll/get-group-enroll-auction/${t}`);l.data&&l.data.length>0?b(l.data):b([])}catch(l){console.error("Error fetching enrollment data:",l),b([])}else b([])},ae=async t=>{const l=t.target.value;if(R(l),te(l),l)try{const s=await i.get(`/group/get-by-id-group/${l}`);console.log("API Response:",s.data),p(s.data||{})}catch(s){console.error("Error fetching group data:",s),p({})}else p({})},le=async t=>{H(t),oe(t)},se=t=>{const l=new Date(t),s={day:"numeric",month:"short",year:"numeric"};return l.toLocaleDateString("en-US",s).replace(",","")},re=t=>{const l=new Date(t);l.setDate(l.getDate()-10);const s={day:"numeric",month:"short",year:"numeric"};return l.toLocaleDateString("en-US",s).replace(","," ")},oe=async t=>{var l;if(q(t),t)try{const s=await i.get(`/auction/get-group-auction/${t}`);if(s.data&&s.data.length>0){x(s.data);const c=[{id:1,date:re((l=s==null?void 0:s.data[0])==null?void 0:l.auction_date),name:"Commencement",phone_number:"Commencement",ticket:"Commencement",bid_amount:0,amount:0,auction_type:"Commencement Auction"},...s.data.map((o,m)=>{var T,I;return{_id:o._id,id:m+2,date:se(o.auction_date),name:(T=o.user_id)==null?void 0:T.full_name,phone_number:(I=o.user_id)==null?void 0:I.phone_number,ticket:o.ticket,bid_amount:parseInt(o.divident)+parseInt(o.commission),amount:o.win_amount,auction_type:(o==null?void 0:o.auction_type.charAt(0).toUpperCase())+(o==null?void 0:o.auction_type.slice(1))+" Auction",action:e.jsx("div",{className:"flex justify-end gap-2",children:e.jsx("button",{onClick:()=>ie(o._id),className:"border border-red-400 text-white px-4 py-2 rounded-md shadow hover:border-red-700 transition duration-200",children:e.jsx(ye,{color:"red"})})})}})];L(c)}else x([])}catch(s){console.error("Error fetching enrollment data:",s),x([])}else x([])},ne=[{key:"id",header:"SL. NO"},{key:"date",header:"Auction Date"},{key:"name",header:"Customer Name"},{key:"phone_number",header:"Customer Phone Number"},{key:"ticket",header:"Ticket"},{key:"bid_amount",header:"Bid Amount"},{key:"amount",header:"Win Amount"},{key:"auction_type",header:"Auction Type"},{key:"action",header:"Action"}];r.useEffect(()=>{if(d&&n.bid_amount){const t=d.group_value*5/100||0,l=(d.group_value||0)-(n.bid_amount||0),s=(n.bid_amount||0)-t,c=d.group_members?s/d.group_members:0,o=(d.group_install||0)-c;v(m=>({...m,group_id:d._id,commission:t,win_amount:l,divident:s,divident_head:c,payable:o,group_type:d.group_type}))}},[d,n.bid_amount]);const de=async t=>{t.preventDefault();try{console.log(n),(await i.post("/auction/add-auction",n)).status===201&&(alert("Auction Added Successfully"),window.location.reload(),k(!1))}catch(l){console.error("Error submitting auction data:",l)}},ie=async t=>{try{const l=await i.get(`/auction/get-auction-by-id/${t}`);_(l.data),f(!0)}catch(l){console.error("Error fetching enroll:",l)}},ce=async()=>{if(j)try{await i.delete(`/auction/delete-auction/${j._id}`),alert("Auction deleted successfully"),f(!1),_(null),window.location.reload()}catch(t){console.error("Error deleting auction:",t)}},ue=async t=>{try{const l=await i.get(`/auction/get-auction-by-id/${t}`);Q(l.data),S(!0)}catch(l){console.error("Error fetching auction:",l)}};return e.jsx(e.Fragment,{children:e.jsx("div",{className:"w-screen",children:e.jsxs("div",{className:"flex mt-20",children:[e.jsx(me,{onGlobalSearchChangeHandler:U,visibility:!0}),e.jsxs("div",{className:"flex-grow p-7",children:[e.jsx("h1",{className:"text-2xl font-semibold text-center",children:"Auction Report"}),e.jsxs("div",{className:"mt-6 mb-8 bg-blue-50",children:[e.jsxs("div",{className:"mb-10 ",children:[e.jsx("label",{className:"flex w-auto p-4 gap-2 justify-center items-center select-none font-semibold  shadow-sm mb-2 rounded-sm",htmlFor:"SS",children:" Search Or Select Group"}),e.jsx("div",{className:"flex justify-center items-center w-full",children:e.jsx(be,{id:"SS",showSearch:!0,popupMatchSelectWidth:!1,value:h||void 0,onChange:le,placeholder:"Search or Select Auction",style:{height:"50px",width:"600px"},filterOption:(t,l)=>l.children.toString().toLowerCase().includes(t.toLowerCase()),children:w.map(t=>e.jsx("option",{value:t._id,children:t.group_name},t._id))})}),e.jsx("p",{className:"text-xl items-center mt-5"}),((C=(A=y[0])==null?void 0:A.group_id)==null?void 0:C.group_type)==="double"&&e.jsx(e.Fragment,{children:e.jsxs("p",{className:"text-xl text-right font-bold",children:["Balance: â‚¹",X.amount]})})]}),e.jsx("div",{className:"",children:y&&y.length>0?e.jsx(xe,{updateHandler:ue,data:ge(u,Z),columns:ne,exportedFileName:`AuctionsReport-${u.length>0?u[1].name+" to "+u[u.length-1].name:"empty"}.csv`}):e.jsx(he,{})})]})]}),e.jsx(N,{isVisible:z,onClose:()=>k(!1),children:e.jsxs("div",{className:"py-6 px-5 lg:px-8 text-left",children:[e.jsx("h3",{className:"mb-4 text-xl font-bold text-gray-900 ",children:"Add Auction"}),e.jsxs("form",{className:"space-y-6",onSubmit:de,children:[e.jsxs("div",{className:"w-full bg-blue-50 rounded-md shadow-md p-2",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"category",children:"Group"}),e.jsxs("select",{value:P,onChange:ae,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5",children:[e.jsx("option",{value:"",children:"Select Group"}),w.map(t=>e.jsx("option",{value:t._id,children:t.group_name},t._id))]})]}),e.jsxs("div",{className:"flex flex-row justify-between space-x-4",children:[e.jsxs("div",{className:"w-1/2",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"group_value",children:"Group Value"}),e.jsx("input",{type:"text",name:"group_value",value:d.group_value||0,id:"group_value",placeholder:"select group to check",readOnly:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5"})]}),e.jsxs("div",{className:"w-1/2",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"group_install",children:"Group Installment"}),e.jsx("input",{type:"text",name:"group_install",value:d.group_install||0,id:"group_install",placeholder:"select group to check",readOnly:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5"})]})]}),d.group_type==="double"&&e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"category",children:"Auction Type"}),e.jsxs("select",{name:"auction_type",value:n.auction_type,onChange:g,required:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5",children:[e.jsx("option",{value:"normal",children:"Normal Auction"}),e.jsx("option",{value:"free",children:"Free Auction"})]})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"category",children:"Customers"}),e.jsxs("select",{name:"user_id",value:`${n.user_id}-${n.ticket}`,onChange:ee,required:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5",children:[e.jsx("option",{value:"",children:"Select Customer"}),W.map(t=>e.jsxs("option",{value:`${t.user_id._id}-${t.tickets}`,children:[t.user_id.full_name," | ",t.tickets]},`${t.user_id._id}-${t.tickets}`))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"email",children:"Bid Amount"}),e.jsx("input",{type:"number",name:"bid_amount",value:n.bid_amount,onChange:g,id:"name",placeholder:"Enter the Bid Amount",required:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5"})]}),e.jsxs("div",{className:"flex flex-row justify-between space-x-4",children:[e.jsxs("div",{className:"w-1/2",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"group_value",children:"Commission"}),e.jsx("input",{type:"text",name:"commission",value:n.commission,id:"commission",placeholder:"",readOnly:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5"})]}),e.jsxs("div",{className:"w-1/2",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"group_install",children:"Winning Amount"}),e.jsx("input",{type:"text",name:"win_amount",value:n.win_amount,id:"win_amount",placeholder:"",readOnly:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5"})]})]}),e.jsxs("div",{className:"flex flex-row justify-between space-x-4",children:[e.jsxs("div",{className:"w-1/2",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"group_value",children:"Divident"}),e.jsx("input",{type:"text",name:"divident",value:n.divident,id:"divident",placeholder:"",readOnly:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5"})]}),e.jsxs("div",{className:"w-1/2",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"group_install",children:"Divident per Head"}),e.jsx("input",{type:"text",name:"divident_head",value:n.divident_head,id:"divident_head",placeholder:"",readOnly:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5"})]}),e.jsxs("div",{className:"w-1/2",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"group_install",children:"Next Payable"}),e.jsx("input",{type:"text",name:"payable",value:n.payable,id:"payable",placeholder:"",readOnly:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5"})]})]}),e.jsxs("div",{className:"flex flex-row justify-between space-x-4",children:[e.jsxs("div",{className:"w-1/2",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"date",children:"Auction Date"}),e.jsx("input",{type:"date",name:"auction_date",value:n.auction_date,onChange:g,id:"date",placeholder:"Enter the Date",required:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5"})]}),e.jsxs("div",{className:"w-1/2",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"date",children:"Next Date"}),e.jsx("input",{type:"date",name:"next_date",value:n.next_date,onChange:g,id:"date",placeholder:"Enter the Date",required:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5"})]})]}),e.jsx("button",{type:"submit",className:`w-full text-white bg-blue-700 hover:bg-blue-800
              focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center`,children:"Add"})]})]})}),e.jsx(N,{isVisible:K,onClose:()=>S(!1),children:e.jsxs("div",{className:"py-6 px-5 lg:px-8 text-left",children:[e.jsx("h3",{className:"mb-4 text-xl font-bold text-gray-900",children:"View Auction"}),e.jsxs("form",{className:"space-y-6",onSubmit:()=>{},children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"email",children:"Group"}),e.jsx("input",{type:"text",name:"group_id",value:(D=a==null?void 0:a.group_id)==null?void 0:D.group_name,onChange:()=>{},id:"name",placeholder:"Enter the Group Name",readOnly:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5"})]}),e.jsxs("div",{className:"flex flex-row justify-between space-x-4",children:[e.jsxs("div",{className:"w-1/2",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"group_value",children:"Group Value"}),e.jsx("input",{type:"text",name:"group_value",value:(F=a==null?void 0:a.group_id)==null?void 0:F.group_value,id:"group_value",placeholder:"select group to check",readOnly:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5"})]}),e.jsxs("div",{className:"w-1/2",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"group_install",children:"Group Installment"}),e.jsx("input",{type:"text",name:"group_install",value:(O=a==null?void 0:a.group_id)==null?void 0:O.group_install,id:"group_install",placeholder:"select group to check",readOnly:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5"})]})]}),((E=a==null?void 0:a.group_id)==null?void 0:E.group_type)==="double"&&e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"category",children:"Auction Type"}),e.jsx("input",{type:"text",name:"group_id",value:(a==null?void 0:a.auction_type.charAt(0).toUpperCase())+(a==null?void 0:a.auction_type.slice(1))+" Auction",onChange:()=>{},id:"name",placeholder:"Enter the User Name",readOnly:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"email",children:"Customer"}),e.jsx("input",{type:"text",name:"group_id",value:`${($=a==null?void 0:a.user_id)==null?void 0:$.full_name} | ${a==null?void 0:a.ticket}`,onChange:()=>{},id:"name",placeholder:"Enter the User Name",readOnly:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"email",children:"Bid Amount"}),e.jsx("input",{type:"number",name:"bid_amount",value:((M=a==null?void 0:a.group_id)==null?void 0:M.group_value)-(a==null?void 0:a.win_amount),onChange:()=>{},id:"name",placeholder:"Enter the Bid Amount",readOnly:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5"})]}),e.jsxs("div",{className:"flex flex-row justify-between space-x-4",children:[e.jsxs("div",{className:"w-1/2",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"group_value",children:"Commission"}),e.jsx("input",{type:"text",name:"commission",value:a==null?void 0:a.commission,id:"commission",placeholder:"",readOnly:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5"})]}),e.jsxs("div",{className:"w-1/2",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"group_install",children:"Winning Amount"}),e.jsx("input",{type:"text",name:"win_amount",value:a==null?void 0:a.win_amount,id:"win_amount",placeholder:"",readOnly:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5"})]})]}),e.jsxs("div",{className:"flex flex-row justify-between space-x-4",children:[e.jsxs("div",{className:"w-1/2",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"group_value",children:"Divident"}),e.jsx("input",{type:"text",name:"divident",value:a==null?void 0:a.divident,id:"divident",placeholder:"",readOnly:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5"})]}),e.jsxs("div",{className:"w-1/2",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"group_install",children:"Divident per Head"}),e.jsx("input",{type:"text",name:"divident_head",value:a==null?void 0:a.divident_head,id:"divident_head",placeholder:"",readOnly:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5"})]}),e.jsxs("div",{className:"w-1/2",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"group_install",children:"Next Payable"}),e.jsx("input",{type:"text",name:"payable",value:a==null?void 0:a.payable,id:"payable",placeholder:"",readOnly:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5"})]})]}),e.jsxs("div",{className:"flex flex-row justify-between space-x-4",children:[e.jsxs("div",{className:"w-1/2",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"date",children:"Auction Date"}),e.jsx("input",{type:"date",name:"auction_date",value:a==null?void 0:a.auction_date,onChange:()=>{},id:"date",placeholder:"Enter the Date",readOnly:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5"})]}),e.jsxs("div",{className:"w-1/2",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"date",children:"Next Date"}),e.jsx("input",{type:"date",name:"next_date",value:a==null?void 0:a.next_date,onChange:()=>{},id:"date",placeholder:"Enter the Date",readOnly:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5"})]})]})]})]})}),e.jsx(N,{isVisible:J,onClose:()=>{f(!1),_(null)},children:e.jsxs("div",{className:"py-6 px-5 lg:px-8 text-left",children:[e.jsx("h3",{className:"mb-4 text-xl font-bold text-gray-900",children:"Sure want to delete this Auction ?"}),j&&e.jsx("form",{onSubmit:t=>{t.preventDefault(),ce()},className:"space-y-6",children:e.jsx("button",{type:"submit",className:`w-full text-white bg-red-700 hover:bg-red-800
                    focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center`,children:"Delete"})})]})})]})})})};export{_e as default};
