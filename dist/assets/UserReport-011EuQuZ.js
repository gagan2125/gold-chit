import{r as a,b as f,j as e,g as I,N as Je,e as Ke,D as me,f as Qe}from"./index-CVU8XVJV.js";const ht=()=>{const[ue,xe]=a.useState([]),[Ve,fe]=a.useState([]),[p,he]=a.useState([]),[m,pe]=a.useState(""),[y,ye]=a.useState([]),[Xe,v]=a.useState(""),[w,_]=a.useState([]),[Ye,be]=a.useState([]),[Ze,b]=a.useState([]),[et,Ne]=a.useState(""),[tt,je]=a.useState(""),[Se,at]=a.useState(()=>new Date().toISOString().split("T")[0]),[ve,st]=a.useState(()=>new Date().toISOString().split("T")[0]),[lt,T]=a.useState(0),[ot,_e]=a.useState(""),[nt,Pe]=a.useState(""),[we,k]=a.useState(!1),[rt,$]=a.useState(!1);a.useState(!1);const[N,R]=a.useState({groupId:"",ticket:""}),[Te,ke]=a.useState(""),[L,ge]=a.useState(""),[Ae,De]=a.useState(""),[F,Ee]=a.useState("");a.useState(""),a.useState("");const[g,Ge]=a.useState(""),[Be,j]=a.useState([]),[h,dt]=a.useState({});a.useState(!1),a.useState(!1),a.useState(null),a.useState(!1),a.useState(null),a.useState(!1);const[A,Ce]=a.useState("");a.useState("cash");const[O,ct]=a.useState(()=>new Date().toISOString().split("T")[0]),[W,it]=a.useState(""),[H,mt]=a.useState(""),[ut,M]=a.useState([]),[xt,U]=a.useState([]),[Ie,q]=a.useState(!0),[S,$e]=a.useState("groupDetails"),[Re,Le]=a.useState(""),Fe=s=>{Le(s.target.value)},D=s=>{$e(s)},[P,z]=a.useState({group_id:"",user_id:"",ticket:"",receipt_no:"",pay_date:"",amount:"",pay_type:"cash",transaction_id:""});a.useEffect(()=>{q(!0),(async()=>{k(!0);try{const t=await f.get("/user/get-user");xe(t.data),q(!1),k(!1)}catch(t){console.error("Error fetching group data:",t)}finally{k(!1)}})()},[]),a.useEffect(()=>{(async()=>{try{const t=await f.get(`/user/get-user-by-id/${m}`);ye(t.data)}catch(t){console.error("Error fetching group data:",t)}})()},[m]),a.useEffect(()=>{(async()=>{try{const t=await f.get("/payment/get-latest-receipt");Ce(t.data)}catch(t){console.error("Error fetching receipt data:",t)}})()},[]),a.useEffect(()=>{A&&z(s=>({...s,receipt_no:A.receipt_no}))},[A]),a.useEffect(()=>{(async()=>{try{const t=await f.get("/user/get-user");b(t.data)}catch(t){console.error("Error fetching group data:",t)}})()},[]);const Oe=async s=>{Ge(s),pe(s),He(s)},We=s=>{const t=s.target.value;if(t){const[d,c]=t.split("|");R({groupId:d,ticket:c})}else R({groupId:"",ticket:""})};a.useEffect(()=>{(async()=>{try{const t=await f.get("/payment/get-report-daybook",{params:{pay_date:O,groupId:g,userId:H,pay_type:W}});if(t.data&&t.data.length>0){j(t.data);const c=t.data.reduce((r,o)=>r+Number(o.amount||0),0);M(c);const i=t.data.map((r,o)=>{var l;return{id:o+1,group:r.group_id.group_name,name:(l=r.user_id)==null?void 0:l.full_name,phone_number:r.user_id.phone_number,ticket:r.ticket,amount:r.amount,mode:r.pay_type}});fe(i)}else j([])}catch(t){console.error("Error fetching payment data:",t),j([]),M(0)}})()},[g,O,W,H]);const He=async s=>{if(s)try{const t=await f.post(`/enroll/get-user-tickets-report/${s}`);if(t.data&&t.data.length>0){j(t.data);const d=t.data.map((l,n)=>{var Y,Z,ee,te,ae,se,le,oe,ne,re,de,ce,ie;const u=((Z=(Y=l==null?void 0:l.enrollment)==null?void 0:Y.group)==null?void 0:Z.group_name)||"",ze=((ee=l==null?void 0:l.enrollment)==null?void 0:ee.tickets)||"",E=(ae=(te=l==null?void 0:l.enrollment)==null?void 0:te.group)==null?void 0:ae.group_type,x=parseInt((le=(se=l==null?void 0:l.enrollment)==null?void 0:se.group)==null?void 0:le.group_install)||0,G=parseInt((oe=l==null?void 0:l.auction)==null?void 0:oe.auctionCount)||0,B=((ne=l==null?void 0:l.payments)==null?void 0:ne.totalPaidAmount)||0,V=((re=l==null?void 0:l.profit)==null?void 0:re.totalProfit)||0,C=((de=l==null?void 0:l.payable)==null?void 0:de.totalPayable)||0,X=((ce=l==null?void 0:l.firstAuction)==null?void 0:ce.firstDividentHead)||0;return(ie=l==null?void 0:l.enrollment)!=null&&ie.group?{id:n+1,group:u,ticket:ze,totalBePaid:E==="double"?x*G+x:C+x+V,profit:V,toBePaidAmount:E==="double"?x*G+x:C+x+X,paidAmount:B,balance:E==="double"?x*G+x-B:C+x+X-B}:null}).filter(l=>l!==null);he(d),v(0);const c=d.reduce((l,n)=>l+((n==null?void 0:n.totalBePaid)||0),0);ke(c);const i=d.reduce((l,n)=>l+((n==null?void 0:n.toBePaidAmount)||0),0);Ee(i);const r=t.data.reduce((l,n)=>{var u;return l+(((u=n==null?void 0:n.payments)==null?void 0:u.totalPaidAmount)||0)},0);ge(r);const o=t.data.reduce((l,n)=>{var u;return l+(((u=n==null?void 0:n.profit)==null?void 0:u.totalProfit)||0)},0);De(o)}else j([]),v(0)}catch(t){console.error("Error fetching enrollment data:",t),j([]),v(0)}else j([]),v(0)},Me=[{key:"id",header:"SL. NO"},{key:"group",header:"Group Name"},{key:"ticket",header:"Ticket"},{key:"totalBePaid",header:"Amount to be Paid"},{key:"profit",header:"Profit"},{key:"toBePaidAmount",header:"Net To be Paid"},{key:"paidAmount",header:"Amount Paid"},{key:"balance",header:"Balance"}],Ue=s=>new Date(s).toISOString().split("T")[0];a.useEffect(()=>{(async()=>{_([]),$(!0);try{const t=await f.get(`/enroll/get-user-payment?group_id=${N.groupId}&ticket=${N.ticket}&user_id=${m}`);if(t.data&&t.data.length>0){b(t.data);const d=t.data;Ne(d[0].groupPaidAmount);const c=t.data;je(c[0].totalToBePaidAmount);let i=0;const r=t.data.map((o,l)=>(i+=Number(o.amount),{_id:o._id,id:l+1,date:Ue(o==null?void 0:o.pay_date),amount:o.amount,receipt:o.receipt_no,old_receipt:o.old_receipt_no,type:o.pay_type,balance:i}));r.push({id:"",date:"",amount:"",receipt:"",old_receipt:"",type:"",balance:i}),_(r)}else b([]),_([])}catch(t){console.error("Error fetching enrollment data:",t),b([]),_([])}finally{$(!1)}})()},[m,N.groupId,N.ticket]);const qe=[{key:"id",header:"SL. NO"},{key:"date",header:"Date"},{key:"amount",header:"Amount"},{key:"receipt",header:"Receipt No"},{key:"old_receipt",header:"Old Receipt No"},{key:"type",header:"Payment Type"},{key:"balance",header:"Balance"}],J=s=>{const t=s.split("-");return t.length===3?`${t[2]}-${t[1]}-${t[0]}`:s},K=J(Se),Q=J(ve);return a.useEffect(()=>{(async()=>{try{const t=await f.get(`/group-report/get-group-enroll-date/${m}?fromDate=${K}&toDate=${Q}`);if(t.data&&t.data.length>0){b(t.data);const d=t.data;_e(d[0].groupPaidAmount||0);const c=t.data;Pe(c[0].totalToBePaidAmount);const i=t.data.reduce((o,l)=>o+parseInt(l.amount),0);T(i);const r=t.data.map((o,l)=>{var n,u;return{id:l+1,name:(n=o==null?void 0:o.user)==null?void 0:n.full_name,phone_number:(u=o==null?void 0:o.user)==null?void 0:u.phone_number,ticket:o.ticket,amount_to_be_paid:parseInt(o.group.group_install)+o.totalToBePaidAmount,amount_paid:o.totalPaidAmount,amount_balance:parseInt(o.group.group_install)+o.totalToBePaidAmount-o.totalPaidAmount}});be(r)}else b([]),T(0)}catch(t){console.error("Error fetching enrollment data:",t),b([]),T(0)}})()},[m,K,Q]),a.useEffect(()=>{if(h&&P.bid_amount){const s=h.group_value*5/100||0,t=(h.group_value||0)-(P.bid_amount||0),d=(P.bid_amount||0)-s,c=h.group_members?d/h.group_members:0,i=(h.group_install||0)-c;z(r=>({...r,group_id:h._id,commission:s,win_amount:t,divident:d,divident_head:c,payable:i}))}},[h,P.bid_amount]),a.useEffect(()=>{m?f.post(`/enroll/get-next-tickets/${m}`).then(s=>{U(s.data.availableTickets||[])}).catch(s=>{console.error("Error fetching available tickets:",s)}):U([])},[m]),Ie?e.jsxs("div",{className:"w-screen m-24",children:[e.jsx(I,{color:"text-green-600"}),";"]}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"w-screen",children:e.jsxs("div",{className:"flex mt-20",children:[e.jsx(Je,{onGlobalSearchChangeHandler:Fe,visibility:!0}),e.jsxs("div",{className:"flex-grow p-7",children:[e.jsx("h1",{className:"text-2xl font-semibold text-center",children:"Reports - Customer"}),e.jsxs("div",{className:"mt-6 mb-8",children:[e.jsx("div",{className:"mb-2",children:e.jsx("div",{className:"flex justify-center items-center w-full gap-4 bg-blue-50 rounded-md shadow-md p-2",children:e.jsxs("div",{className:"mb-2",children:[e.jsxs("label",{className:"flex w-auto p-4 gap-2 justify-center items-center select-none font-semibold  shadow-sm mb-2 rounded-sm",htmlFor:"SS",children:[" ","Search Or Select Customer"]}),e.jsx(Ke,{id:"SS",value:g||void 0,onChange:Oe,showSearch:!0,popupMatchSelectWidth:!1,placeholder:"Search or Select Customer",filterOption:(s,t)=>t.children.toString().toLowerCase().includes(s.toLowerCase()),style:{height:"50px",width:"600px"},children:ue.map(s=>e.jsxs("option",{value:s._id,children:[s.full_name," - ",s.phone_number]},s._id))})]})})}),m&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"mt-6 mb-8",children:[e.jsxs("div",{className:"flex justify-start border-b border-gray-300 mb-4",children:[e.jsx("button",{className:`px-6 py-2 font-medium ${S==="groupDetails"?"border-b-2 border-yellow-500 text-yellow-500":"text-gray-500"}`,onClick:()=>D("groupDetails"),children:"Customer Details"}),e.jsx("button",{className:`px-6 py-2 font-medium ${S==="basicReport"?"border-b-2 border-yellow-500 text-yellow-500":"text-gray-500"}`,onClick:()=>D("basicReport"),children:"Customer Ledger"}),e.jsx("button",{className:`px-6 py-2 font-medium ${S==="dateWiseReport"?"border-b-2 border-yellow-500 text-yellow-500":"text-gray-500"}`,onClick:()=>D("dateWiseReport"),children:"Passbook"})]}),S==="groupDetails"&&e.jsx(e.Fragment,{children:we?e.jsx("p",{children:"loading..."}):e.jsxs("div",{className:"mt-10",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex flex-col flex-1",children:[e.jsx("label",{className:"mb-1 text-sm font-medium text-gray-700",children:"Name"}),e.jsx("input",{type:"text",placeholder:"Enter Name",value:y.full_name,readonly:!0,className:"border border-gray-300 rounded px-4 py-2 shadow-sm outline-none w-full"})]}),e.jsxs("div",{className:"flex flex-col flex-1",children:[e.jsx("label",{className:"mb-1 text-sm font-medium text-gray-700",children:"Email"}),e.jsx("input",{type:"text",placeholder:"Enter Email",value:y.email,readonly:!0,className:"border border-gray-300 rounded px-4 py-2 shadow-sm outline-none w-full"})]}),e.jsxs("div",{className:"flex flex-col flex-1",children:[e.jsx("label",{className:"mb-1 text-sm font-medium text-gray-700",children:"Phone Number"}),e.jsx("input",{type:"text",placeholder:"Enter Phone Number",value:y.phone_number,readonly:!0,className:"border border-gray-300 rounded px-4 py-2 shadow-sm outline-none w-full"})]})]}),e.jsxs("div",{className:"flex gap-4 mt-5",children:[e.jsxs("div",{className:"flex flex-col flex-1",children:[e.jsx("label",{className:"mb-1 text-sm font-medium text-gray-700",children:"Adhaar Number"}),e.jsx("input",{type:"text",placeholder:"Enter Adhaar Number",value:y.adhaar_no,readonly:!0,className:"border border-gray-300 rounded px-4 py-2 shadow-sm outline-none w-full"})]}),e.jsxs("div",{className:"flex flex-col flex-1",children:[e.jsx("label",{className:"mb-1 text-sm font-medium text-gray-700",children:"Pan Number"}),e.jsx("input",{type:"text",placeholder:"Enter Pan Number",value:y.pan_no,readonly:!0,className:"border border-gray-300 rounded px-4 py-2 shadow-sm outline-none w-full"})]}),e.jsxs("div",{className:"flex flex-col flex-1",children:[e.jsx("label",{className:"mb-1 text-sm font-medium text-gray-700",children:"Pincode"}),e.jsx("input",{type:"text",placeholder:"Enter Pincode",value:y.pincode,readonly:!0,className:"border border-gray-300 rounded px-4 py-2 shadow-sm outline-none w-full"})]})]}),e.jsx("div",{className:"flex gap-4 mt-5",children:e.jsxs("div",{className:"flex flex-col flex-1",children:[e.jsx("label",{className:"mb-1 text-sm font-medium text-gray-700",children:"Address"}),e.jsx("input",{type:"text",placeholder:"Address",value:y.address,readonly:!0,className:"border border-gray-300 rounded px-4 py-2 shadow-sm outline-none w-full"})]})}),e.jsxs("div",{className:"mt-10",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"Enrolled Groups"}),p&&p.length>0?e.jsx("div",{className:"mt-5",children:e.jsx(me,{data:Qe(p,Re),columns:Me,exportedFileName:`CustomerReport-${p.length>0?p[0].date+" to "+p[p.length-1].date:"empty"}.csv`})}):e.jsx(I,{})]}),e.jsxs("div",{className:"flex gap-4 mt-5",children:[e.jsxs("div",{className:"flex flex-col flex-1",children:[e.jsx("label",{className:"mb-1 text-sm font-medium text-gray-700",children:"Total Amount to be Paid"}),e.jsx("input",{type:"text",placeholder:"-",value:Te,readonly:!0,className:"border border-gray-300 rounded px-4 py-2 shadow-sm outline-none w-full"})]}),e.jsxs("div",{className:"flex flex-col flex-1",children:[e.jsx("label",{className:"mb-1 text-sm font-medium text-gray-700",children:"Total Profit"}),e.jsx("input",{type:"text",placeholder:"-",value:Ae,readonly:!0,className:"border border-gray-300 rounded px-4 py-2 shadow-sm outline-none w-full"})]}),e.jsxs("div",{className:"flex flex-col flex-1",children:[e.jsx("label",{className:"mb-1 text-sm font-medium text-gray-700",children:"Total Net To be Paid"}),e.jsx("input",{type:"text",placeholder:"-",value:F,readonly:!0,className:"border border-gray-300 rounded px-4 py-2 shadow-sm outline-none w-full"})]}),e.jsxs("div",{className:"flex flex-col flex-1",children:[e.jsx("label",{className:"mb-1 text-sm font-medium text-gray-700",children:"Total Amount Paid"}),e.jsx("input",{type:"text",placeholder:"-",value:L,readonly:!0,className:"border border-gray-300 rounded px-4 py-2 shadow-sm outline-none w-full"})]}),e.jsxs("div",{className:"flex flex-col flex-1",children:[e.jsx("label",{className:"mb-1 text-sm font-medium text-gray-700",children:"Total Balance"}),e.jsx("input",{type:"text",placeholder:"-",value:F-L,readonly:!0,className:"border border-gray-300 rounded px-4 py-2 shadow-sm outline-none w-full"})]})]})]})}),S==="basicReport"&&e.jsx(e.Fragment,{children:e.jsxs("div",{children:[e.jsx("div",{className:"flex gap-4",children:e.jsxs("div",{className:"flex flex-col flex-1",children:[e.jsx("label",{className:"mb-1 text-sm font-medium text-gray-700",children:"Groups and Tickets"}),e.jsxs("select",{value:N.groupId?`${N.groupId}|${N.ticket}`:"",onChange:We,className:"border border-gray-300 rounded px-6 py-2 shadow-sm outline-none w-full max-w-md",children:[e.jsx("option",{value:"",children:"Select Group | Ticket"}),Be.map(s=>{var t;return(t=s==null?void 0:s.enrollment)!=null&&t.group?e.jsxs("option",{value:`${s.enrollment.group._id}|${s.enrollment.tickets}`,children:[s.enrollment.group.group_name," |"," ",s.enrollment.tickets]},s.enrollment.group._id):null})]})]})}),w&&w.length>0?e.jsx("div",{className:"mt-10",children:e.jsx(me,{data:w,columns:qe})}):e.jsx(I,{})]})}),S==="dateWiseReport"&&e.jsx("div",{className:"mt-7",children:e.jsx("h1",{className:"text-2xl",children:"Coming Soon"})})]})})]})]})]})})})};export{ht as default};
