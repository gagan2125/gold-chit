import{r as d,j as e,N as Y,S as Z,C as ee,D as ae,c as N,b as m,d as te,I as se}from"./index-DAP0bqfI.js";const oe=()=>{const[b,G]=d.useState([]),[x,D]=d.useState([]),[A,le]=d.useState(""),[T,h]=d.useState(!1),[U,y]=d.useState(!1),[M,f]=d.useState(!1),[g,_]=d.useState(null),[P,V]=d.useState(null);d.useState("");const[re,W]=d.useState([]),[v,$]=d.useState([]),[w,O]=d.useState([]),[r,u]=d.useState({}),[I,B]=d.useState(""),H=a=>{const{value:t}=a.target;B(t)},[j,p]=d.useState({visibility:!1,message:"Something went wrong!",type:"info"}),[o,S]=d.useState({lead_name:"",lead_phone:"",lead_profession:"",group_id:"",lead_type:"",lead_customer:"",lead_needs:"",note:""}),[n,L]=d.useState({lead_name:"",lead_phone:"",lead_profession:"",group_id:"",lead_type:"",lead_customer:"",lead_agent:"",lead_needs:"",note:""}),c=a=>{const{name:t,value:l}=a.target;S(s=>({...s,[t]:l})),u(s=>({...s,[t]:""}))},C=a=>{const t={},l=a==="addLead"?o:n;return l.lead_name.trim()||(t.lead_name="Lead Name is required"),l.lead_phone?/^[6-9]\d{9}$/.test(l.lead_phone)||(t.lead_phone="Invalid phone number (must be 10 digits)"):t.lead_phone="Phone Number is required",l.lead_profession||(t.lead_profession="Profession is required"),l.lead_type||(t.lead_type="Lead Source Type is required"),l.lead_type==="customer"&&!l.lead_customer&&(t.lead_customer="Customer selection is required"),l.lead_type==="agent"&&!l.lead_agent&&(t.lead_agent="Agent selection is required"),l.lead_needs.trim()||(t.lead_needs="Lead Needs and Goals is required"),u(t),Object.keys(t).length===0},R=async a=>{a.preventDefault();const t=C("addLead");try{if(t){if(h(!1),(await m.post("/lead/add-lead",o,{headers:{"Content-Type":"application/json"}})).status>=400)throw new Error("Unable to add Lead");p({visibility:!0,message:"Lead added successfully",type:"success"}),S({lead_name:"",lead_phone:"",lead_profession:"",group_id:"",lead_type:"",lead_customer:"",lead_agent:"",lead_needs:"",note:""})}}catch{h(!1),p({visibility:!0,message:"Lead added successfully",type:"error"})}};d.useEffect(()=>{(async()=>{try{const t=await m.get("/group/get-group-admin");G(t.data)}catch(t){console.error("Error fetching group data:",t)}})()},[]),d.useEffect(()=>{(async()=>{try{const t=await m.get("/lead/get-lead");console.log("response data",t.data),W(t.data);const l=t.data.map((s,X)=>{var E,F,q;return{_id:s._id,id:X+1,name:s.lead_name,phone:s.lead_phone,profession:s.lead_profession,lead_needs:s==null?void 0:s.lead_needs,group_id:(E=s==null?void 0:s.group_id)==null?void 0:E.group_name,date:s==null?void 0:s.createdAt.split("T")[0],lead_type:s.lead_type==="agent"?"employee":s.lead_type,note:s==null?void 0:s.note,lead_type_name:s.lead_type==="customer"?(F=s==null?void 0:s.lead_customer)==null?void 0:F.full_name:s.lead_type==="agent"?(q=s==null?void 0:s.lead_agent)==null?void 0:q.name:"",action:e.jsx("div",{className:"flex justify-center gap-2",children:e.jsx(te,{menu:{items:[{key:"1",label:e.jsx("div",{className:"text-green-600",onClick:()=>k(s._id),children:"Edit"})},{key:"2",label:e.jsx("div",{className:"text-red-600",onClick:()=>z(s._id),children:"Delete"})}]},placement:"bottomLeft",children:e.jsx(se,{className:"text-bold"})})})}});D(l)}catch(t){console.error("Error fetching group data:",t)}})()},[]),b.filter(a=>a.group_name.toLowerCase().includes(A.toLowerCase()));const z=async a=>{try{const t=await m.get(`/lead/get-lead-by-id/${a}`);_(t.data),y(!0)}catch(t){console.error("Error fetching lead:",t)}},k=async a=>{var t;try{const l=await m.get(`/lead/get-lead-by-id/${a}`);console.log("The response data is ",l.data);const s=l.data;V(l.data),L({lead_name:l.data.lead_name,lead_phone:l.data.lead_phone,lead_profession:l.data.lead_profession,group_id:l.data.group_id,lead_type:l.data.lead_type,lead_customer:l.data.lead_customer,lead_agent:l.data.lead_agent,lead_needs:(t=l.data)==null?void 0:t.lead_needs,note:l.data.note}),f(!0),u({})}catch(l){console.error("Error fetching group:",l)}},i=a=>{const{name:t,value:l}=a.target;L(s=>({...s,[t]:l})),u(s=>({...s,[t]:""}))},J=async()=>{if(g)try{await m.delete(`/lead/delete-lead/${g._id}`),y(!1),_(null),p({visibility:!0,message:"Lead deleted successfully",type:"success"})}catch(a){console.error("Error deleting lead:",a)}},K=async a=>{a.preventDefault();const t=C();try{t&&(await m.put(`/lead/update-lead/${P._id}`,n),f(!1),p({visibility:!0,message:"Lead Updated Successfully",type:"success"}))}catch(l){console.error("Error updating group:",l)}},Q=[{key:"id",header:"SL. NO"},{key:"name",header:"Lead Name"},{key:"phone",header:"Lead Phone Number"},{key:"profession",header:"Lead Profession"},{key:"date",header:"Date"},{key:"group_id",header:"Group Name"},{key:"lead_type",header:"Lead Source Type"},{key:"lead_needs",header:"Lead Needs And Goals"},{key:"lead_type_name",header:"Lead Source Name"},{key:"note",header:"Note"},{key:"action",header:"Action"}];return d.useEffect(()=>{(async()=>{try{const t=await m.get("/user/get-user");$(t.data)}catch(t){console.error("Error fetching user data:",t)}})()},[]),d.useEffect(()=>{(async()=>{try{const t=await m.get("/agent/get-agent");O(t.data)}catch(t){console.error("Error fetching agent data:",t)}})()},[]),e.jsx(e.Fragment,{children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex mt-20",children:[e.jsx(Y,{onGlobalSearchChangeHandler:H,visibility:!0}),e.jsx(Z,{}),e.jsx(ee,{type:j.type,isVisible:j.visibility,message:j.message}),e.jsxs("div",{className:"flex-grow p-7",children:[e.jsx("div",{className:"mt-6 mb-8 ",children:e.jsxs("div",{className:"flex justify-between items-center w-full ",children:[e.jsx("h1",{className:"text-2xl font-semibold ",children:"Leads"}),e.jsx("button",{onClick:()=>{h(!0),u({})},className:"ml-4 bg-blue-800 text-white px-4 py-2 rounded shadow-md hover:bg-yellow-500 transition duration-200",children:"+ Add Lead"})]})}),e.jsx(ae,{updateHandler:k,data:x.filter(a=>Object.values(a).some(t=>String(t).toLowerCase().includes(I.toLowerCase()))),columns:Q,exportedFileName:`Leads-${x.length>0?x[0].date+" to "+x[x.length-1].date:"empty"}.csv`}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-8"})]})]}),e.jsx(N,{isVisible:T,onClose:()=>{h(!1),u({})},children:e.jsxs("div",{className:"py-6 px-5 lg:px-8 text-left",children:[e.jsx("h3",{className:"mb-4 text-xl font-bold text-gray-900",children:"Add Lead"}),e.jsxs("form",{className:"space-y-6",onSubmit:R,noValidate:!0,children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"email",children:"Lead Name"}),e.jsx("input",{type:"text",name:"lead_name",value:o.lead_name,onChange:c,id:"name",placeholder:"Enter the Lead Name",required:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5"}),r.lead_name&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:r.lead_name})]}),e.jsxs("div",{className:"flex flex-row justify-between space-x-4",children:[e.jsxs("div",{className:"w-1/2",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"date",children:"Lead Phone Number"}),e.jsx("input",{type:"number",name:"lead_phone",value:o.lead_phone,onChange:c,id:"text",placeholder:"Enter Phone Number",required:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5"}),r.lead_phone&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:r.lead_phone})]}),e.jsxs("div",{className:"w-1/2",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"date",children:"Lead Work/Profession"}),e.jsxs("select",{name:"lead_profession",id:"category",value:o.lead_profession,onChange:c,required:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5",children:[e.jsx("option",{value:"",children:"Select Work/Profession"}),e.jsx("option",{value:"employed",children:"Employed"}),e.jsx("option",{value:"self_employed",children:"Self Employed"})]}),r.lead_profession&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:r.lead_profession})]})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"category",children:"Group"}),e.jsxs("select",{name:"group_id",id:"category",value:o.group_id,onChange:c,required:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5",children:[e.jsx("option",{value:"",children:"Select Group"}),b.map(a=>e.jsx("option",{value:a._id,children:a.group_name},a._id))]})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"category",children:"Lead Source Type"}),e.jsxs("select",{name:"lead_type",id:"category",value:o.lead_type,onChange:c,required:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5",children:[e.jsx("option",{value:"",children:"Select Lead Source Type"}),e.jsx("option",{value:"social",children:"Social Media"}),e.jsx("option",{value:"customer",children:"Customer"}),e.jsx("option",{value:"agent",children:"Employee"}),e.jsx("option",{value:"walkin",children:"Walkin"})]}),r.lead_type&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:r.lead_type})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"date",children:"Note"}),e.jsx("input",{type:"text",name:"note",value:o.note,onChange:c,id:"text",placeholder:"Specify note if any!",required:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5"})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"category",children:"Lead Needs and Goals"}),e.jsxs("select",{name:"lead_needs",id:"category",value:o.lead_needs,onChange:c,required:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5",children:[e.jsx("option",{value:"",children:"Select Lead Needs and Goals"}),e.jsx("option",{value:"savings",children:"Savings"}),e.jsx("option",{value:"borrowings",children:"Borrowings"})]}),r.lead_needs&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:r.lead_needs})]}),o.lead_type==="customer"&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"category",children:"Customers"}),e.jsxs("select",{name:"lead_customer",id:"category",value:o.lead_customer,onChange:c,required:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5",children:[e.jsx("option",{value:"",children:"Select Customer"}),v.map(a=>e.jsx("option",{value:a._id,children:a.full_name},a._id))]}),r.lead_customer&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:r.lead_customer})]})}),o.lead_type==="agent"&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"category",children:"Agents"}),e.jsxs("select",{name:"lead_agent",id:"category",value:o.lead_agent,onChange:c,required:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5",children:[e.jsx("option",{value:"",children:"Select Agent"}),w.map(a=>e.jsx("option",{value:a._id,children:a.name},a._id))]}),r.lead_agent&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:r.lead_agent})]})}),e.jsx("button",{type:"submit",className:`w-full text-white bg-blue-700 hover:bg-yellow-500
                                focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center`,children:"Add"})]})]})}),e.jsx(N,{isVisible:M,onClose:()=>{f(!1),u({})},children:e.jsxs("div",{className:"py-6 px-5 lg:px-8 text-left",children:[e.jsx("h3",{className:"mb-4 text-xl font-bold text-gray-900",children:"Update Lead"}),e.jsxs("form",{className:"space-y-6",onSubmit:K,noValidate:!0,children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"email",children:"Lead Name"}),e.jsx("input",{type:"text",name:"lead_name",value:n.lead_name,onChange:i,id:"name",placeholder:"Enter the Group Name",required:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5"}),r.lead_name&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:r.lead_name})]}),e.jsxs("div",{className:"flex flex-row justify-between space-x-4",children:[e.jsxs("div",{className:"w-1/2",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"date",children:"Lead Phone Number"}),e.jsx("input",{type:"text",name:"lead_phone",value:n.lead_phone,onChange:i,id:"text",placeholder:"Enter Lead Phone Number",required:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5"}),r.lead_phone&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:r.lead_phone})]}),e.jsxs("div",{className:"w-1/2",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"date",children:"Lead Work/Profession"}),e.jsxs("select",{name:"lead_profession",id:"category",value:n.lead_profession,onChange:i,required:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5",children:[e.jsx("option",{value:"",children:"Select Work/Profession"}),e.jsx("option",{value:"employed",children:"Employed"}),e.jsx("option",{value:"self_employed",children:"Self Employed"})]}),r.lead_profession&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:r.lead_profession})]})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"category",children:"Group"}),e.jsxs("select",{name:"group_id",id:"category",value:n.group_id,onChange:i,required:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5",children:[e.jsx("option",{value:"",children:"Select Group"}),b.map(a=>e.jsx("option",{value:a._id,children:a.group_name},a._id))]})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"category",children:"Lead Source Type"}),e.jsxs("select",{name:"lead_type",id:"category",value:n.lead_type,onChange:i,required:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5",children:[e.jsx("option",{value:"",children:"Select Lead Source Type"}),e.jsx("option",{value:"social",children:"Social Media"}),e.jsx("option",{value:"customer",children:"Customer"}),e.jsx("option",{value:"agent",children:"Employee"}),e.jsx("option",{value:"walkin",children:"Walkin"})]}),r.lead_type&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:r.lead_type})]}),n.lead_type==="customer"&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"category",children:"Customers"}),e.jsxs("select",{name:"lead_customer",id:"category",value:n.lead_customer,onChange:i,required:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5",children:[e.jsx("option",{value:"",children:"Select Customer"}),v.map(a=>e.jsx("option",{value:a._id,children:a.full_name},a._id))]}),r.lead_customer&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:r.lead_customer})]})})," ",e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"date",children:"Note"}),e.jsx("input",{type:"text",name:"note",value:n.note,onChange:i,id:"text",placeholder:"Specify note if any!",required:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5"}),e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"category",children:"Lead Needs and Goals"}),e.jsxs("select",{name:"lead_needs",id:"category",value:n.lead_needs,onChange:i,required:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5",children:[e.jsx("option",{value:"",children:"Select Lead Needs and Goals"}),e.jsx("option",{value:"savings",children:"Savings"}),e.jsx("option",{value:"borrowings",children:"Borrowings"})]}),r.lead_needs&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:r.lead_needs})]}),n.lead_type==="agent"&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"category",children:"Agents"}),e.jsxs("select",{name:"lead_agent",id:"category",value:n.lead_agent,onChange:i,required:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5",children:[e.jsx("option",{value:"",children:"Select Agent"}),w.map(a=>e.jsx("option",{value:a._id,children:a.name},a._id))]}),r.lead_agent&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:r.lead_agent})]})}),e.jsx("button",{type:"submit",className:`w-full text-white bg-blue-700 hover:bg-blue-800
              focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center`,children:"Update"})]})]})}),e.jsx(N,{isVisible:U,onClose:()=>{y(!1),_(null)},children:e.jsxs("div",{className:"py-6 px-5 lg:px-8 text-left",children:[e.jsx("h3",{className:"mb-4 text-xl font-bold text-gray-900",children:"Delete Lead"}),g&&e.jsxs("form",{onSubmit:a=>{a.preventDefault(),J()},className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block mb-2 text-sm font-medium text-gray-900",htmlFor:"groupName",children:["Please enter"," ",e.jsx("span",{className:"text-primary font-bold",children:g.lead_name})," ","to confirm deletion."]}),e.jsx("input",{type:"text",id:"groupName",placeholder:"Enter the Lead Name",required:!0,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full p-2.5"})]}),e.jsx("button",{type:"submit",className:`w-full text-white bg-red-700 hover:bg-red-800
          focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center`,children:"Delete"})]})]})})]})})};export{oe as default};
